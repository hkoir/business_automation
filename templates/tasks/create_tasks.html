{% extends 'base.html' %}  

{% block content %}



<style>
    
.select2-container {
        width: 40% !important; /* Ensure the container is 100% wide */
    }
  
    
.select2-search__field {
        width: 100% !important; 
    }
.table td,th{
    white-space: nowrap;
    text-align: center;
}
  
.select2-container--default .select2-selection--single {
        border: 1px solid #ccc;
        border-radius: 4px;
        height: 38px;
        display: flex;
        align-items: center;
    }

</style>


<div class="container-fluid main-content">
    <div class="row">  
        <div class="col-12">   
        
            <div class="col-12">                            
                <div class="card shadow" style="padding:10px;background-color:aliceblue;">
                    <div class="card-body">
                        <h4 class="card-title text-center"><strong>Create Task</strong> </h4>
                        <form method="post" enctype="multipart/form-data" id="add_category">
                            {% csrf_token %} 
                            <div class="container">
                                <div class="row">
                                    <div class="col-6 col-md-3">
                                       Task Title: {{ form.title }}
                                    </div>
                                    <div class="col-6 col-md-3">
                                        Assigned type: {{ form.assigned_to }}
                                     </div>
                                     <div class="col-6 col-md-3">
                                        Team: {{ form.assigned_to_team }}
                                     </div>
                                     <div class="col-6 col-md-3">
                                        member: {{ form.assigned_to_employee }}
                                     </div>
                                     <div class="col-6 col-md-3 p-1">
                                        Task Manager: {{ form.task_manager }}
                                     </div>
                                     <div class="col-6 col-md-3">
                                        Assigned score: {{ form.assigned_number }}
                                     </div>
                                     <div class="col-6 col-md-3">
                                        Due date: {{ form.due_datetime}}
                                     </div>
                                     <div class="col-6 col-md-3">
                                        Priority {{ form.priority }}
                                     </div>
                                     <div class="col-6 col-md-3">
                                        remarks {{ form.remarks }}
                                     </div>
                                     <div class="col-6 col-md-3">
                                        <button type="submit" name="add_to_basket" class="btn btn btn-primary mt-4">Submit</button>
                                     </div>
                                    </form>
                                </div>
                            </div>
                            
                           
                       
                     </div>
                </div>        
            </div>
        
        <div class="col-12">    
            <h2 class="mt-4">Tasks List</h2>   
            <form method="get">
                <label for="start_date">Start Date:</label>
                <input type="date" id="start_date" name="start_date" value="{{ request.GET.start_date }}">
                
                <label for="end_date">End Date:</label>
                <input type="date" id="end_date" name="end_date" value="{{ request.GET.end_date }}">
            
                <button type="submit" class="btn btn-sm btn-primary">Filter</button>
            </form>
           
            <table class="table table-striped mt-2">
                <thead>
                    <tr class="bg-primary text-white">
                        <th>Task ID</th>
                        <th>Title</th>
                        <th>Priority</th>
                        <th>Assigned Date</th>
                        <th>Due date</th>                        
                        <th>Assigned to</th>                      
                        <th>Remarks</th>
                        
                    </tr>
                </thead>
                <tbody>
                    {% for task in page_obj %}
                    <tr>
                        <td>{{ task.task_id }}</td>
                        <td>{{ task.title}}</td>
                        <td>{{ task.priority }}</td>
                        <td>{{ task.assigned_datetime }}</td>
                        <td>{{ task.due_datetime}}</td>                  
                     
                        <td>
                            {% if task.assigned_to_employee %}
                           member: {{ task.assigned_to_employee }}
                            {% else %}
                            Team:{{ task.assigned_to_team }}
                            {% endif %}
                        </td>   
                   
                        <td>{{ task.remarks }}</td>
                       
                    
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="7" style="text-align: center;">No records found.</td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        </div>  

    </div>
    <!-- Pagination Controls -->
      <div class="pagination">
        <span class="step-links">
            {% if page_obj.has_previous %}
                <a href="?page=1">&laquo; first</a>
                <a href="?page={{ page_obj.previous_page_number }}">previous</a>
            {% endif %}

            <span class="current">
                Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
            </span>

            {% if page_obj.has_next %}
                <a href="?page={{ page_obj.next_page_number }}">next</a>
                <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
            {% endif %}
        </span>
    </div>


</div>





<div style="height:800px"></div>




<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="successModalLabel">Success</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                {{ messages }}
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>



<!-- Bootstrap Modal for displaying Django message -->
<div class="modal fade" id="messageModal" tabindex="-1" aria-labelledby="messageModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="messageModalLabel">Messages</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body" id="messagesContainer">
                {% for message in messages %}
                    <div class="alert alert-{{ message.tags }}">{{ message }}</div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<h4 style="height:400px"></h4>






<script>
    $(document).ready(function() {  
        function toggleFields() {
            var assignedTypeValue = $('#id_assigned_to').val();           

            if (assignedTypeValue === 'team') {               
                $('#id_assigned_to_team').show();
                $('#id_assigned_to_employee').hide();
            } else if (assignedTypeValue === 'member') {                
                $('#id_assigned_to_team').hide();
                $('#id_assigned_to_employee').show();
            } else {
                
                $('#id_assigned_to_team').hide();
                $('#id_assigned_to_employee').hide();
            }
        }

        $(document).ready(function() {
            toggleFields();

            $('#id_assigned_to').change(function() {
                toggleFields();
            });
        });

    });
</script>


<script>
    // Show Django message modal if there are messages
    document.addEventListener("DOMContentLoaded", function() {
        const messageModal = document.getElementById('messageModal');
        if (messageModal && document.getElementById('messagesContainer').children.length > 0) {
            new bootstrap.Modal(messageModal).show();
        }
    });

</script>

    

{% endblock %}